<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å“åº”å¼æ™ºèƒ½æ‰“å¡ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary-color: #08e0cb;
            --completed-color: #4CAF50;
            --missed-color: #f44336;
            --planned-color: #FFC107;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
        }

        /* æ ¸å¿ƒå¸ƒå±€ä¿®å¤ï¼šç”µè„‘ç«¯ä¿æŒæ¯”ä¾‹ */
        .container { 
            display: grid; 
            grid-template-columns: 1fr; /* é»˜è®¤æ‰‹æœºç«¯å•åˆ— */
            gap: 20px; 
        }

        @media (min-width: 850px) { /* å½“å±å¹•å®½åº¦å¤§äº850pxæ—¶åº”ç”¨ç”µè„‘ç«¯å¸ƒå±€ */
            .container { 
                grid-template-columns: 2.5fr 1fr; 
            }
            .editor-card { 
                grid-column: 1 / -1; 
            }
        }

        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            box-sizing: border-box;
        }

        /* æ—¥å†æ ·å¼ */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        .calendar-table th { padding: 10px; color: #666; font-size: 14px; }
        .calendar-table td { 
            height: 60px; 
            text-align: center; 
            border: 1px solid #f0f0f0; 
            cursor: pointer; 
            position: relative; 
            font-size: 14px;
        }
        .current-day { background: #e0fcf9; color: var(--primary-color); font-weight: bold; }
        .selected-day { border: 2px solid var(--primary-color) !important; }
        .day-status { width: 8px; height: 8px; border-radius: 50%; position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); }
        
        /* çŠ¶æ€ç‚¹é¢œè‰² */
        .status-completed .day-status { background: var(--completed-color); }
        .status-missed .day-status { background: var(--missed-color); }
        .status-planned .day-status { background: var(--planned-color); }

        /* ä»»åŠ¡æ¸…å•ä¿®å¤ */
        .task-list-card { min-height: 400px; display: flex; flex-direction: column; }
        .task-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; margin-bottom: 15px; padding-bottom: 10px; }
        .task-item { display: flex; align-items: center; margin-bottom: 12px; gap: 10px; }
        .task-checkbox { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #ccc; cursor: pointer; appearance: none; flex-shrink: 0; }
        .task-checkbox:checked { background: var(--completed-color); border-color: var(--completed-color); }
        .task-text { flex-grow: 1; outline: none; padding: 5px; word-break: break-all; }
        .task-done { text-decoration: line-through; color: #bbb; }
        .delete-btn { color: #ff5252; cursor: pointer; font-size: 18px; padding: 0 5px; }

        /* ç¼–è¾‘å™¨æº¢å‡ºä¿®å¤ */
        #markdown-editor { 
            width: 100%; 
            box-sizing: border-box; /* æ ¸å¿ƒï¼šé˜²æ­¢è¶…å‡ºè¾¹æ¡† */
            height: 150px; 
            margin-top: 15px; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            resize: vertical;
            font-size: 16px;
        }

        .toolbar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        .mood-btns span { cursor: pointer; font-size: 1.2em; margin-right: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="calendar-header">
                <button onclick="changeMonth(-1)">â†</button>
                <h3 id="month-display" style="margin:0"></h3>
                <button onclick="changeMonth(1)">â†’</button>
            </div>
            <table class="calendar-table" id="calendar-body"></table>
            <div id="month-stats" style="margin-top: 15px; font-size: 14px; color: #666;"></div>
        </div>

        <div class="card task-list-card">
            <div class="task-header">
                <h4 id="task-title" style="margin:0">ä»Šæ—¥ä»»åŠ¡</h4>
                <button onclick="addNewTask()" style="background:var(--completed-color); color:white; border:none; border-radius:50%; width:26px; height:26px; cursor:pointer;">+</button>
            </div>
            <div id="tasks-container"></div>
        </div>

        <div class="card editor-card">
            <div class="toolbar">
                <select id="status-select">
                    <option value="planned">â³ è®¡åˆ’ä¸­</option>
                    <option value="completed">âœ… å·²å®Œæˆ</option>
                    <option value="missed">âŒ æœªå®Œæˆ</option>
                </select>
                <div class="mood-btns">
                    <span onclick="setMood('ğŸ˜Š')">ğŸ˜Š</span>
                    <span onclick="setMood('ğŸ˜')">ğŸ˜</span>
                    <span onclick="setMood('ğŸ˜¢')">ğŸ˜¢</span>
                </div>
                <span id="day-mood-display" style="font-size: 14px;">ä»Šæ—¥å¿ƒæƒ…: -</span>
            </div>
            <textarea id="markdown-editor" placeholder="åœ¨æ­¤è®°å½•ä»Šæ—¥å¿ƒå¾—..."></textarea>
        </div>
    </div>

    <script>
        // ... (æ­¤å¤„ä¿æŒä¹‹å‰å‘é€ç»™ä½ çš„ JavaScript é€»è¾‘ä¸å˜) ...
        // åŒ…å« getStorageKey, saveAllData, loadDayData, renderTaskItem, 
        // addNewTask, initCalendar, changeMonth, setMood, updateStats, window.onload
        
        let currentDate = new Date();
        let selectedDate = new Date();
        let mood = "";

        const getStorageKey = (date) => `study_data_${date.getFullYear()}_${date.getMonth() + 1}_${date.getDate()}`;

        function saveAllData(isSilent = true) {
            const tasks = [];
            document.querySelectorAll('.task-item').forEach(item => {
                tasks.push({
                    text: item.querySelector('.task-text').innerText,
                    done: item.querySelector('.task-checkbox').checked
                });
            });

            const dayData = {
                tasks: tasks,
                note: document.getElementById('markdown-editor').value,
                status: document.getElementById('status-select').value,
                mood: mood
            };

            localStorage.setItem(getStorageKey(selectedDate), JSON.stringify(dayData));
            initCalendar();
            updateStats();
        }

        function loadDayData(date) {
            selectedDate = date;
            const data = JSON.parse(localStorage.getItem(getStorageKey(date)) || '{"tasks":[],"note":"","status":"planned","mood":""}');
            const container = document.getElementById('tasks-container');
            container.innerHTML = '';
            data.tasks.forEach(t => renderTaskItem(t.text, t.done));
            document.getElementById('markdown-editor').value = data.note;
            document.getElementById('status-select').value = data.status;
            mood = data.mood;
            document.getElementById('day-mood-display').innerText = `ä»Šæ—¥å¿ƒæƒ…: ${mood || '-'}`;
            document.getElementById('task-title').innerText = `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥ ä»»åŠ¡`;
            initCalendar();
        }

        function renderTaskItem(text, done) {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `
                <input type="checkbox" class="task-checkbox" ${done ? 'checked' : ''}>
                <div class="task-text ${done ? 'task-done' : ''}" contenteditable="true">${text}</div>
                <div class="delete-btn">Ã—</div>
            `;
            const cb = div.querySelector('.task-checkbox');
            const txt = div.querySelector('.task-text');
            cb.onchange = () => { txt.classList.toggle('task-done', cb.checked); saveAllData(); };
            txt.onblur = () => saveAllData();
            div.querySelector('.delete-btn').onclick = () => { div.remove(); saveAllData(); };
            document.getElementById('tasks-container').appendChild(div);
        }

        function addNewTask() { renderTaskItem("æ–°ä»»åŠ¡", false); saveAllData(); }

        function initCalendar() {
            const body = document.getElementById('calendar-body');
            document.getElementById('month-display').innerText = `${currentDate.getFullYear()}å¹´ ${currentDate.getMonth() + 1}æœˆ`;
            body.innerHTML = '<tr><th>æ—¥</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th></tr>';
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
            const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
            let row = document.createElement('tr');
            for (let i = 0; i < firstDay; i++) row.appendChild(document.createElement('td'));
            for (let day = 1; day <= daysInMonth; day++) {
                if ((day + firstDay - 1) % 7 === 0 && day !== 1) { body.appendChild(row); row = document.createElement('tr'); }
                const td = document.createElement('td');
                const dateObj = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                td.innerText = day;
                if(dateObj.toDateString() === selectedDate.toDateString()) td.className = 'selected-day';
                if(dateObj.toDateString() === new Date().toDateString()) td.classList.add('current-day');
                const saved = localStorage.getItem(getStorageKey(dateObj));
                if (saved) {
                    td.classList.add(`status-${JSON.parse(saved).status}`);
                    const dot = document.createElement('div');
                    dot.className = 'day-status';
                    td.appendChild(dot);
                }
                td.onclick = () => loadDayData(dateObj);
                row.appendChild(td);
            }
            body.appendChild(row);
        }

        function changeMonth(step) { currentDate.setMonth(currentDate.getMonth() + step); initCalendar(); updateStats(); }

        function setMood(m) { mood = m; document.getElementById('day-mood-display').innerText = `ä»Šæ—¥å¿ƒæƒ…: ${m}`; saveAllData(); }

        function updateStats() {
            let completed = 0;
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const days = new Date(year, month, 0).getDate();
            for (let d = 1; d <= days; d++) {
                const data = localStorage.getItem(`study_data_${year}_${month}_${d}`);
                if (data && JSON.parse(data).status === 'completed') completed++;
            }
            document.getElementById('month-stats').innerHTML = `æœ¬æœˆæ‰“å¡å¤©æ•°: <strong>${completed}</strong> å¤©`;
        }

        window.onload = () => {
            loadDayData(new Date());
            updateStats();
            document.getElementById('status-select').onchange = () => saveAllData();
            document.getElementById('markdown-editor').onblur = () => saveAllData();
        };
    </script>
</body>
</html>